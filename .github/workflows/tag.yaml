name: git tag release

on:
    workflow_dispatch:

jobs:
    release:
        runs-on: ubuntu-latest
        steps:
            - name: Check out repository code
              uses: actions/checkout@v3

            - name: Approve tag creation
              uses: trstringer/manual-approval@v1
              with: 
                secret: ${{ github.TOKEN }}
                approvers: SumptaOj
              
            - name: Create tag
              run: |
                PACKAGE_VERSION=$(jq -r .version package.json)
                echo "PACKAGE_VERSION=${PACKAGE_VERSION}"
                git tag $PACKAGE_VERSION
                git push origin $PACKAGE_VERSION

            - name: Create tag release note
              run: |
                curl -L \
                  -X POST \
                  -H "Accept: application/vnd.github+json" \
                  -H "Authorization: Bearer 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" \
                  -H "X-GitHub-Api-Version: 2022-11-28" \
                  https://api.github.com/repos/OWNER/REPO/releases \
                  -d '{"tag_name":${PACKAGE_VERSION},"target_commitish":"main","name":${PACKAGE_VERSION},"body":"Description of the release","draft":false,"prerelease":false,"generate_release_notes":false}'